from flask import Flask, request, render_template, redirect, url_for
import sqlite3

app = Flask(__name__)

# Initialize the database
def init_db():
    conn = sqlite3.connect('dishes.db')
    c = conn.cursor()
    c.execute('''CREATE TABLE IF NOT EXISTS dishes
                 (id INTEGER PRIMARY KEY, name TEXT, price REAL, password TEXT)''')
    conn.commit()
    conn.close()

# Route to display all dishes
@app.route('/')
def index():
    conn = sqlite3.connect('dishes.db')
    c = conn.cursor()
    c.execute("SELECT id, name, price FROM dishes")
    dishes = c.fetchall()
    conn.close()
    return render_template('index.html', dishes=dishes)

# Route to add a new dish
@app.route('/add', methods=['POST'])
def add_dish():
    name = request.form['name']
    price = request.form['price']
    password = request.form['password']

    conn = sqlite3.connect('dishes.db')
    c = conn.cursor()
    c.execute("INSERT INTO dishes (name, price, password) VALUES (?, ?, ?)", (name, price, password))
    conn.commit()
    conn.close()

    return redirect(url_for('index'))

# Route to remove a dish
@app.route('/remove', methods=['POST'])
def remove_dish():
    dish_id = request.form['id']
    password = request.form['password']

    conn = sqlite3.connect('dishes.db')
    c = conn.cursor()
    c.execute("SELECT password FROM dishes WHERE id=?", (dish_id,))
    stored_password = c.fetchone()

    if stored_password and stored_password[0] == password:
        c.execute("DELETE FROM dishes WHERE id=?", (dish_id,))
        conn.commit()

    conn.close()
    return redirect(url_for('index'))

# HTML templates
@app.route('/template')
def template():
    return '''
    <!DOCTYPE html>
    <html>
    <head>
        <title>Dish List</title>
    </head>
    <body>
        <h1>Add a Dish</h1>
        <form action="/add" method="post">
            <label for="name">Dish Name:</label>
            <input type="text" id="name" name="name" required><br><br>
            <label for="price">Price:</label>
            <input type="text" id="price" name="price" required><br><br>
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required><br><br>
            <input type="submit" value="Add Dish">
        </form>
        <h1>Available Dishes</h1>
        <ul>
            {% for dish in dishes %}
            <li>{{ dish[1] }} - ${{ dish[2] }}
                <form action="/remove" method="post" style="display:inline;">
                    <input type="hidden" name="id" value="{{ dish[0] }}">
                    <input type="password" name="password" placeholder="Enter password to remove">
                    <input type="submit" value="Remove">
                </form>
            </li>
            {% endfor %}
        </ul>
    </body>
    </html>
    '''


